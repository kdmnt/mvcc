# Author: Konstantinos Diamantidis - March 2020

# This is the YAML file that gets parsed by the mvcc.py script
# Supported DBMSs are: MySQL | Oracle | SQL Server | PostgreSQL
# Adding more DBMS(s) is possible, mvcc.py would require relevant updating

# CONFIG SECTION
# must be in the format '<dbms (lower case)>-config' (e.g.: mysql-config)
# must include 'host', 'user', 'password', 'db' with proper values
# if any of the above are wrong (or non-existent), an error message will be shown when running mvcc.py
mysql-config:
    host: 127.0.0.1
    user: root
    password: dbtech
    db: testdb
postgres-config:
    host: 127.0.0.1
    user: dbtech
    password: dbtech
    db: test
sqlserver-config:
    host: 127.0.0.1
    user: SA
    password: DBtech123
    db: T
oracle-config:
    host: 127.0.0.1
    user: dbtech
    password: dbtech
    db: XE

# TABLE INITIALIZATION SECTION
# must be in the format 'table-initialization'
# contains SQL commands to re-initialize the table being used so as to have clean data
table-initialization:
    - "DROP TABLE T;;"
    - 'CREATE TABLE T (id INT NOT NULL PRIMARY KEY, x INT);;'
    - 'INSERT INTO T VALUES (1, 1);;'
    - 'INSERT INTO T VALUES (2, 2);;'
    - 'INSERT INTO T VALUES (3, 3);;'
    - 'COMMIT;;'    # COMMIT statements are programmed (in the python script) to be omitted when running sql server tests

# TESTS SECTION
# must be in the format '<dbms (lower case)>-tests' (e.g.: mysql-tests)
# must include subsections in the format 'test<sorted number>' (e.g. test1)
# each test subsection must be in the format 'step<sorted number>_T<transaction number> (e.g. step3_T2)
# currently supporting up to 3 concurrent transactions
# each subsection can include a descriptive comment which will be used in the title of the window
# (e.g. test2: # Anomaly|Non-Repeatable Read - Isolation|Serializable)
oracle-tests:
    # oracle varchar must be with single quote (') and not double (")
    test1:    # Anomaly|Non-Repeatable Read - Isolation|Read Committed
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'UPDATE T SET x=12 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'SELECT * FROM T ORDER BY id;;'
        step4_T2:
            - '--   S T E P  4  --'
            - '-------------------'
            - 'COMMIT;;'
        step5_T1:
            - '--   S T E P  5  --'
            - '-------------------'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'

    test2:    # Anomaly|Non-Repeatable Read - Isolation|Serializable
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'UPDATE T SET x=12 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
            
    test3:    # Anomaly|Lost Update - Isolation|Read Committed
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'UPDATE T SET x=12 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=13 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'

    test4:    # Anomaly|Lost Update - Isolation|Serializable
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'UPDATE T SET x=12 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=13 WHERE id=1;;'
            - 'COMMIT;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
            
    test5:    # Anomaly|Ghost Update - Isolation|Serializable
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'DELETE FROM T WHERE id=1;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=12 WHERE id=1;;'
            - 'COMMIT;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'
            
    test6:    # Anomaly|Phantom Update - Isolation|Serializable
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'INSERT INTO T VALUES (4,4);;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=42 WHERE id=4;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'
            
    test7: # Anomaly|Read Skew - Isolation|Read Committed
        step1_T1:
            - '----  TABLE INITIALIZATION  ----'
            - "DROP TABLE accounts;;"
            - 'CREATE TABLE accounts ( account_id INT NOT NULL PRIMARY KEY, balance INT);;'
            - "INSERT INTO accounts VALUES (1, 500);;"
            - "INSERT INTO accounts VALUES (2, 500);;"
            - 'COMMIT;;'
            - '----   S T E P  1  ----'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'SELECT * FROM accounts;;'
        step2_T2:
            - '----   S T E P  2  ----'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'SELECT * FROM accounts;;'
        step3_T1:
            - '----   S T E P  3  ----'
            - 'UPDATE accounts SET balance = balance - 100 WHERE account_id = 1;;'
            - 'SELECT * FROM accounts;;'
        step4_T2:
            - '----   S T E P  4  ----'
            - 'SELECT balance from accounts WHERE account_id = 2;;'
        step5_T1:
            - '----   S T E P  5  ----'
            - 'UPDATE accounts SET balance = balance + 100 WHERE account_id = 2;;'
            - 'COMMIT;;'
            - 'SELECT * from accounts;;'
        step6_T2:
            - '----   S T E P  6  ----'
            - 'SELECT balance from accounts WHERE account_id = 1;;'

    test8: # Anomaly|Read Skew - Isolation|Serializable
        step1_T1:
            - '----  TABLE INITIALIZATION  ----'
            - "DROP TABLE accounts;;"
            - 'CREATE TABLE accounts ( account_id INT NOT NULL PRIMARY KEY, balance INT);;'
            - "INSERT INTO accounts VALUES (1, 500);;"
            - "INSERT INTO accounts VALUES (2, 500);;"
            - 'COMMIT;;'
            - '----   S T E P  1  ----'
            - 'SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;;'
            - 'SELECT * FROM accounts;;'
        step2_T2:
            - '----   S T E P  2  ----'
            - 'SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;;'
            - 'SELECT * FROM accounts;;'
        step3_T1:
            - '----   S T E P  3  ----'
            - 'UPDATE accounts SET balance = balance - 100 WHERE account_id = 1;;'
            - 'SELECT * FROM accounts;;'
        step4_T2:
            - '----   S T E P  4  ----'
            - 'SELECT balance from accounts WHERE account_id = 2;;'
        step5_T1:
            - '----   S T E P  5  ----'
            - 'UPDATE accounts SET balance = balance + 100 WHERE account_id = 2;;'
            - 'COMMIT;;'
            - 'SELECT * from accounts;;'
        step6_T2:
            - '----   S T E P  6  ----'
            - 'SELECT balance from accounts WHERE account_id = 1;;'

    test9:   # Anomaly|Ghost Update - Isolation|Read Committed
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'DELETE FROM T WHERE id=1;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=12 WHERE id=1;;'
            - 'COMMIT;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'

    test10:   # Anomaly|Phantom Update - Isolation|Read Committed
        step1_T1:
            - '-- Step 1. Session 1, Transaction T1'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
        step2_T2:
            - '-- Step 2. Meanwhile in a concurrent Session 2, Transaction 2'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'INSERT INTO T VALUES (4,4);;'
            - 'COMMIT;;'
        step3_T1:
            - '-- Step 3. T1 of Session 1 continues'
            - 'UPDATE T SET x=42 WHERE id=4;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'
    test11: # Anomaly|Write Skew - Isolation|Read Committed
        step1_T1:
            - '--  TABLE INITIALIZATION  --'
            - '----------------------------'
            - "DROP TABLE doctors;;"
            - 'DROP PROCEDURE currently_on_call;;'
            - 'CREATE TABLE doctors (name VARCHAR2(255) NOT NULL PRIMARY KEY, on_call VARCHAR2(10), shift_id INT);;'
            - "INSERT INTO doctors (name, on_call, shift_id) VALUES ('Alice', 'true', 1234);;"
            - "INSERT INTO doctors (name, on_call, shift_id) VALUES ('Bob', 'true', 1234);;"
            - "INSERT INTO doctors (name, on_call, shift_id) VALUES ('Carol', 'false', 1234);;"
            - 'COMMIT;;'
            - 'column name format a10'
            - 'column on_call format a7'
            - 'column shift_id format 9999'
            - "CREATE PROCEDURE currently_on_call (doctors_on_call OUT number) IS BEGIN SELECT count(*) INTO doctors_on_call FROM doctors WHERE on_call='true' AND shift_id=1234; END;;"
            - '/'
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'SELECT * FROM doctors;;'
            - 'var doctors_on_call number;;'
            - 'exec currently_on_call(:doctors_on_call);;'
            - 'print :doctors_on_call;;'
        step2_T2:
            - '--  TABLE INITIALIZATION  --'
            - '----------------------------'
            - 'column name format a10'
            - 'column on_call format a7'
            - 'column shift_id format 9999'
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'SELECT * FROM doctors;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - "UPDATE doctors SET on_call = CASE WHEN :doctors_on_call >= 2 THEN 'false' ELSE 'true' END WHERE name = 'Alice' and shift_id=1234;;"
            - 'SELECT * FROM doctors;;'
            - 'COMMIT;;'
        step4_T2:
            - '--   S T E P  4  --'
            - '-------------------'
            - 'var doctors_on_call number;;'
            - 'exec currently_on_call(:doctors_on_call);;'
            - 'print :doctors_on_call;;'
            - "UPDATE doctors SET on_call = CASE WHEN :doctors_on_call >= 2 THEN 'false' ELSE 'true' END WHERE name = 'Bob' and shift_id=1234;;"
            - 'COMMIT;;'
            - 'SELECT * FROM doctors;;'
        step5_T1:
            - '--   S T E P  5  --'
            - '-------------------'
            - 'SELECT * FROM doctors;;'
            - 'COMMIT;;'
        step6_T2:
            - '--   S T E P  6  --'
            - '-------------------'
            - 'SELECT * FROM doctors;;'
            - 'COMMIT;;'
    test12: # Anomaly|Write Skew - Isolation|Serializable
        step1_T1:
            - '--  TABLE INITIALIZATION  --'
            - '----------------------------'
            - "DROP TABLE doctors;;"
            - 'DROP PROCEDURE currently_on_call;;'
            - 'CREATE TABLE doctors (name VARCHAR2(255) NOT NULL PRIMARY KEY, on_call VARCHAR2(10), shift_id INT);;'
            - "INSERT INTO doctors (name, on_call, shift_id) VALUES ('Alice', 'true', 1234);;"
            - "INSERT INTO doctors (name, on_call, shift_id) VALUES ('Bob', 'true', 1234);;"
            - "INSERT INTO doctors (name, on_call, shift_id) VALUES ('Carol', 'false', 1234);;"
            - 'COMMIT;;'
            - 'column name format a10'
            - 'column on_call format a7'
            - 'column shift_id format 9999'
            - "CREATE PROCEDURE currently_on_call (doctors_on_call OUT number) IS BEGIN SELECT count(*) INTO doctors_on_call FROM doctors WHERE on_call='true' AND shift_id=1234; END;;"
            - '/'
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;;'
            - 'SELECT * FROM doctors;;'
            - 'var doctors_on_call number;;'
            - 'exec currently_on_call(:doctors_on_call);;'
            - 'print :doctors_on_call;;'
        step2_T2:
            - '--  TABLE INITIALIZATION  --'
            - '----------------------------'
            - 'column name format a10'
            - 'column on_call format a7'
            - 'column shift_id format 9999'
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;;'
            - 'SELECT * FROM doctors;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - "UPDATE doctors SET on_call = CASE WHEN :doctors_on_call >= 2 THEN 'false' ELSE 'true' END WHERE name = 'Alice' and shift_id=1234;;"
            - 'SELECT * FROM doctors;;'
            - 'COMMIT;;'
        step4_T2:
            - '--   S T E P  4  --'
            - '-------------------'
            - 'var doctors_on_call number;;'
            - 'exec currently_on_call(:doctors_on_call);;'
            - 'print :doctors_on_call;;'
            - "UPDATE doctors SET on_call = CASE WHEN :doctors_on_call >= 2 THEN 'false' ELSE 'true' END WHERE name = 'Bob' and shift_id=1234;;"
            - 'COMMIT;;'
            - 'SELECT * FROM doctors;;'
        step5_T1:
            - '--   S T E P  5  --'
            - '-------------------'
            - 'SELECT * FROM doctors;;'
            - 'COMMIT;;'
        step6_T2:
            - '--   S T E P  6  --'
            - '-------------------'
            - 'SELECT * FROM doctors;;'
            - 'COMMIT;;'



mysql-tests:
    test1:    # Anomaly|Non-Repeatable Read - Isolation|Read Committed
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN;;'
            - 'UPDATE T SET x=12 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'SELECT * FROM T ORDER BY id;;'
        step4_T2:
            - '--   S T E P  4  --'
            - '-------------------'
            - 'COMMIT;;'
        step5_T1:
            - '--   S T E P  5  --'
            - '-------------------'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'

    test2:    # Anomaly|Non-Repeatable Read - Isolation|Repeatable Read
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;;'
            - 'BEGIN;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN;;'
            - 'UPDATE T SET x=12 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'

    test3:    # Anomaly|Lost Update - Isolation|Read Committed
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN;;'
            - 'UPDATE T SET x=12 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=13 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'

    test4:    # Anomaly|Lost Update - Isolation|Repeatable Read
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;;'
            - 'BEGIN;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN;;'
            - 'UPDATE T SET x=12 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=13 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'

    test5:    # Anomaly|Ghost Update - Isolation|Repeatable Read
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;;'
            - 'BEGIN;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN;;'
            - 'DELETE FROM T WHERE id=1;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=13 WHERE id=1;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'

    test6:    # Anomaly|Phantom Update - Isolation|Repeatable Read
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;;'
            - 'BEGIN;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN;;'
            - 'INSERT INTO T VALUES (4,4);;'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=42 WHERE id=4;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'

    test7: # Anomaly|Read Skew - Isolation|Read Committed
        step1_T1:
            - '----  TABLE INITIALIZATION  ----'
            - "DROP TABLE accounts;;"
            - 'CREATE TABLE accounts ( account_id INT NOT NULL PRIMARY KEY, balance INT);;'
            - "INSERT INTO accounts VALUES (1, 500);;"
            - "INSERT INTO accounts VALUES (2, 500);;"
            - 'COMMIT;;'
            - '----   S T E P  1  ----'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN;;'
            - 'SELECT * FROM accounts;;'
        step2_T2:
            - '----   S T E P  2  ----'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN;;'
            - 'SELECT * FROM accounts;;'
        step3_T1:
            - '----   S T E P  3  ----'
            - 'UPDATE accounts SET balance = balance - 100 WHERE account_id = 1;;'
            - 'SELECT * FROM accounts;;'
        step4_T2:
            - '----   S T E P  4  ----'
            - 'SELECT balance from accounts WHERE account_id = 2;;'
        step5_T1:
            - '----   S T E P  5  ----'
            - 'UPDATE accounts SET balance = balance + 100 WHERE account_id = 2;;'
            - 'COMMIT;;'
            - 'SELECT * from accounts;;'
            - 'COMMIT;;'
        step6_T2:
            - '----   S T E P  6  ----'
            - 'SELECT balance from accounts WHERE account_id = 1;;'
            - 'COMMIT;;'

    test8: # Anomaly|Read Skew - Isolation|Repeatable Read
        step1_T1:
            - '----  TABLE INITIALIZATION  ----'
            - "DROP TABLE accounts;;"
            - 'CREATE TABLE accounts ( account_id INT NOT NULL PRIMARY KEY, balance INT);;'
            - "INSERT INTO accounts VALUES (1, 500);;"
            - "INSERT INTO accounts VALUES (2, 500);;"
            - 'COMMIT;;'
            - '----   S T E P  1  ----'
            - 'SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;;'
            - 'BEGIN;;'
            - 'SELECT * FROM accounts;;'
        step2_T2:
            - '----   S T E P  2  ----'
            - 'SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;;'
            - 'BEGIN;;'
            - 'SELECT * FROM accounts;;'
        step3_T1:
            - '----   S T E P  3  ----'
            - 'UPDATE accounts SET balance = balance - 100 WHERE account_id = 1;;'
            - 'SELECT * FROM accounts;;'
        step4_T2:
            - '----   S T E P  4  ----'
            - 'SELECT balance from accounts WHERE account_id = 2;;'
        step5_T1:
            - '----   S T E P  5  ----'
            - 'UPDATE accounts SET balance = balance + 100 WHERE account_id = 2;;'
            - 'COMMIT;;'
            - 'SELECT * from accounts;;'
            - 'COMMIT;;'
        step6_T2:
            - '----   S T E P  6  ----'
            - 'SELECT balance from accounts WHERE account_id = 1;;'
            - 'COMMIT;;'

    test9:    # Anomaly|Ghost Update - Isolation|Read Committed
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step2_T2:
            - '--   S T E P 2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN;;'
            - 'DELETE FROM T WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=13 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'

    test10:    # Anomaly|Phantom Update - Isolation|Read Committed
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN;;'
            - 'INSERT INTO T VALUES (4,4);;'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=42 WHERE id=4;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'

    test11: # Anomaly|Write Skew - Isolation|Read Committed
        step1_T1:
            - '--  TABLE INITIALIZATION  --'
            - '----------------------------'
            - "DROP TABLE IF EXISTS doctors;;"
            - 'DROP PROCEDURE IF EXISTS currently_on_call;;'
            - 'CREATE TABLE doctors (name VARCHAR(255) NOT NULL PRIMARY KEY, on_call VARCHAR(10), shift_id INT);;'
            - 'INSERT INTO doctors VALUES ("Alice", "true", 1234);;'
            - 'INSERT INTO doctors VALUES ("Bob", "true", 1234);;'
            - 'INSERT INTO doctors VALUES ("Carol", "false", 1234);;'
            - 'COMMIT;;'
            - 'DELIMITER //'
            - 'CREATE PROCEDURE currently_on_call(OUT doctors_on_call INT) BEGIN SELECT count(*) INTO doctors_on_call FROM doctors WHERE on_call="true" AND shift_id=1234; END//'
            - 'DELIMITER ;;'
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN;;'
            - 'SELECT * FROM doctors;;'
            - 'CALL currently_on_call(@doctors_on_call);;'
            - 'SELECT @doctors_on_call;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN;;'
            - 'SELECT * FROM doctors;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE doctors SET on_call = IF(@doctors_on_call >= 2, "false", "true") WHERE name = "Alice" and shift_id = 1234;;'
            - 'SELECT * FROM doctors;;'
            - 'COMMIT;;'
        step4_T2:
            - '--   S T E P  4  --'
            - '-------------------'
            - 'CALL currently_on_call(@doctors_on_call);;'
            - 'SELECT @doctors_on_call;;'
            - 'UPDATE doctors SET on_call = IF(@doctors_on_call >= 2, "false", "true") WHERE name = "Bob" and shift_id = 1234;;'
            - 'COMMIT;;'
            - 'SELECT * FROM doctors;;'
            - 'COMMIT;;'
        step5_T1:
            - '--   S T E P  5  --'
            - '-------------------'
            - 'SELECT * FROM doctors;;'
            - 'COMMIT;;'

    test12: # Anomaly|Write Skew - Isolation|Repeatable Read
        step1_T1:
            - '--  TABLE INITIALIZATION  --'
            - '----------------------------'
            - "DROP TABLE IF EXISTS doctors;;"
            - 'DROP PROCEDURE IF EXISTS currently_on_call;;'
            - 'CREATE TABLE doctors (name VARCHAR(255) NOT NULL PRIMARY KEY, on_call VARCHAR(10), shift_id INT);;'
            - 'INSERT INTO doctors VALUES ("Alice", "true", 1234);;'
            - 'INSERT INTO doctors VALUES ("Bob", "true", 1234);;'
            - 'INSERT INTO doctors VALUES ("Carol", "false", 1234);;'
            - 'COMMIT;;'
            - 'DELIMITER //'
            - 'CREATE PROCEDURE currently_on_call(OUT doctors_on_call INT) BEGIN SELECT count(*) INTO doctors_on_call FROM doctors WHERE on_call="true" AND shift_id=1234; END//'
            - 'DELIMITER ;;'
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;;'
            - 'BEGIN;;'
            - 'SELECT * FROM doctors;;'
            - 'CALL currently_on_call(@doctors_on_call);;'
            - 'SELECT @doctors_on_call;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;;'
            - 'BEGIN;;'
            - 'SELECT * FROM doctors;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE doctors SET on_call = IF(@doctors_on_call >= 2, "false", "true") WHERE name = "Alice" and shift_id = 1234;;'
            - 'SELECT * FROM doctors;;'
            - 'COMMIT;;'
        step4_T2:
            - '--   S T E P  4  --'
            - '-------------------'
            - 'CALL currently_on_call(@doctors_on_call);;'
            - 'SELECT @doctors_on_call;;'
            - 'UPDATE doctors SET on_call = IF(@doctors_on_call >= 2, "false", "true") WHERE name = "Bob" and shift_id = 1234;;'
            - 'COMMIT;;'
            - 'SELECT * FROM doctors;;'
            - 'COMMIT;;'
        step5_T1:
            - '--   S T E P  5  --'
            - '-------------------'
            - 'SELECT * FROM doctors;;'
            - 'COMMIT;;'

    test13: # DAD's test13
        step1_T1:
            - '-- Step 1. Session 1, Transaction T1'
            - 'SET INNODB_LOCK_WAIT_TIMEOUT=1000;;'
            - 'DROP TABLE T;;'
            - 'CREATE TABLE T(id int not null primary key, b int);;'
            - 'INSERT INTO T(id,b) VALUES(1,1),(2,2);;'
            - 'COMMIT;;'
            - 'SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;;'
            - 'BEGIN;;'
        step2_T2:
            - '-- Step 2. Session 2, Transaction T2'
            - 'SET INNODB_LOCK_WAIT_TIMEOUT=1000;;'
            - 'SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;;'
            - 'BEGIN;;'
        step3_T2:
            - '-- Step 3. Session 2, Transaction T2'
            - 'UPDATE T SET b=13 WHERE id=1;;'
        step4_T1:
            - '-- Step 4. Session 1, Transaction T1'
            - 'UPDATE T SET b=5 WHERE id=1;;'
            - 'COMMIT;;'
        step5_T2:
            - '-- Step 5. Session 2, Transaction T2'
            - 'COMMIT;;'
        step6_T2:
            - '-- Step 6. Session 2, Transaction T2'
            - 'SELECT * FROM T;;'
            - 'COMMIT;;'



postgres-tests:
    test1:    # Anomaly|Non-Repeatable Read - Isolation|Read Committed
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'UPDATE T SET x=12 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'SELECT * FROM T ORDER BY id;;'
        step4_T2:
            - '--   S T E P  4  --'
            - '-------------------'
            - 'COMMIT;;'
        step5_T1:
            - '--   S T E P  5  --'
            - '-------------------'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'
            
            
    test2:    # Anomaly|Non-Repeatable Read - Isolation|Repeatable Read
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'UPDATE T SET x=12 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
            
            
            
    test3:    # Anomaly|Lost update - Isolation|Read Committed
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'UPDATE T SET x=12 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=13 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
            
            
    test4:    # Anomaly|Lost update - Isolation|Repeatable Read
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'UPDATE T SET x=12 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=13 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
            
            
    test5:    # Anomaly|Ghost update - Isolation|Repeatable Read
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;;'
            - 'SELECT * FROM T ORDER BY id;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'DELETE FROM T WHERE id=1;;'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=12 WHERE id=1;;'
            - 'COMMIT;;'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'
            
            
    test6:    # Anomaly|Phantom update - Isolation|Repeatable Read
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;;'
            - 'SELECT * FROM T ORDER BY id;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'INSERT INTO T VALUES (4,4);;'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=42 WHERE id=4;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'
            
            
            
    test7: # Anomaly|Read Skew - Isolation|Read Committed
        step1_T1:
            - '----  TABLE INITIALIZATION  ----'
            - '\set AUTOCOMMIT on'
            - "DROP TABLE accounts;;"
            - 'CREATE TABLE accounts ( account_id INT NOT NULL PRIMARY KEY, balance INT);;'
            - "INSERT INTO accounts VALUES (1, 500);;"
            - "INSERT INTO accounts VALUES (2, 500);;"
            - '\set AUTOCOMMIT off'
            - '----   S T E P  1  ----'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'SELECT * FROM accounts;;'
        step2_T2:
            - '----   S T E P  2  ----'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'SELECT * FROM accounts;;'
        step3_T1:
            - '----   S T E P  3  ----'
            - 'UPDATE accounts SET balance = balance - 100 WHERE account_id = 1;;'
            - 'SELECT * FROM accounts;;'
        step4_T2:
            - '----   S T E P  4  ----'
            - 'SELECT balance from accounts WHERE account_id = 2;;'
        step5_T1:
            - '----   S T E P  5  ----'
            - 'UPDATE accounts SET balance = balance + 100 WHERE account_id = 2;;'
            - 'COMMIT;;'
            - 'SELECT * from accounts;;'
            - 'COMMIT;;'
        step6_T2:
            - '----   S T E P  6  ----'
            - 'SELECT balance from accounts WHERE account_id = 1;;'
            - 'COMMIT;;'

    test8: # Anomaly|Read Skew - Isolation|Repeatable Read
        step1_T1:
            - '----  TABLE INITIALIZATION  ----'
            - '\set AUTOCOMMIT on'
            - "DROP TABLE accounts;;"
            - 'CREATE TABLE accounts ( account_id INT NOT NULL PRIMARY KEY, balance INT);;'
            - "INSERT INTO accounts VALUES (1, 500);;"
            - "INSERT INTO accounts VALUES (2, 500);;"
            - '\set AUTOCOMMIT off'
            - '----   S T E P  1  ----'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;;'
            - 'SELECT * FROM accounts;;'
        step2_T2:
            - '----   S T E P  2  ----'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;;'
            - 'SELECT * FROM accounts;;'
        step3_T1:
            - '----   S T E P  3  ----'
            - 'UPDATE accounts SET balance = balance - 100 WHERE account_id = 1;;'
            - 'SELECT * FROM accounts;;'
        step4_T2:
            - '----   S T E P  4  ----'
            - 'SELECT balance from accounts WHERE account_id = 2;;'
        step5_T1:
            - '----   S T E P  5  ----'
            - 'UPDATE accounts SET balance = balance + 100 WHERE account_id = 2;;'
            - 'COMMIT;;'
            - 'SELECT * from accounts;;'
            - 'COMMIT;;'
        step6_T2:
            - '----   S T E P  6  ----'
            - 'SELECT balance from accounts WHERE account_id = 1;;'
            - 'COMMIT;;'
    test9:    # Anomaly|Write Skew - Isolation|Read Committed
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'           
            - 'SELECT id,x FROM T WHERE id=2;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=(SELECT X FROM T WHERE id=1) WHERE id=2;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
        step4_T2:
            - '--   S T E P  4  --'
            - '-------------------'
            - 'UPDATE T SET x=(SELECT X FROM T WHERE id=2) WHERE id=1;;'          
            - 'SELECT id,x FROM T ORDER BY id;;'
        step5_T1:
            - '--   S T E P  5  --'
            - '-------------------'
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'
        step6_T2:
            - '--   S T E P  6  --'
            - '-------------------'
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'    
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'                        
 
    test10:   # Anomaly|Write Skew - Isolation|Repeatable Read
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;;'           
            - 'SELECT id,x FROM T WHERE id=2;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=(SELECT X FROM T WHERE id=1) WHERE id=2;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
        step4_T2:
            - '--   S T E P  4  --'
            - '-------------------'
            - 'UPDATE T SET x=(SELECT X FROM T WHERE id=2) WHERE id=1;;'          
            - 'SELECT id,x FROM T ORDER BY id;;'
        step5_T1:
            - '--   S T E P  5  --'
            - '-------------------'
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'
        step6_T2:
            - '--   S T E P  6  --'
            - '-------------------'
            - 'UPDATE T SET x=(SELECT X FROM T WHERE id=2) WHERE id=1;;'          
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'    
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'

    test11:   # Anomaly|Write Skew - Isolation|Serializable
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;;'           
            - 'SELECT id,x FROM T WHERE id=2;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=(SELECT X FROM T WHERE id=1) WHERE id=2;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
        step4_T2:
            - '--   S T E P  4  --'
            - '-------------------'
            - 'UPDATE T SET x=(SELECT X FROM T WHERE id=2) WHERE id=1;;'          
            - 'SELECT id,x FROM T ORDER BY id;;'
        step5_T1:
            - '--   S T E P  5  --'
            - '-------------------'
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'
        step6_T2:
            - '--   S T E P  6  --'
            - '-------------------'
            - 'UPDATE T SET x=(SELECT X FROM T WHERE id=2) WHERE id=1;;'          
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'    
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'                                    

    test12:   # Anomaly|Ghost update - Isolation|Read Committed
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'SELECT * FROM T ORDER BY id;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'DELETE FROM T WHERE id=1;;'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=12 WHERE id=1;;'
            - 'COMMIT;;'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'

    test13:   # Anomaly|Phantom update - Isolation|Read Committed
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'SELECT * FROM T ORDER BY id;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'INSERT INTO T VALUES (4,4);;'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=42 WHERE id=4;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'

    test14:    # Anomaly|Non-Repeatable Read - Isolation|Serializable
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'UPDATE T SET x=12 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
    test15:    # Anomaly|Lost update - Isolation|Serializable
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'UPDATE T SET x=12 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=13 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'          
    test16:    # Anomaly|Ghost update - Isolation|Serializable
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;;'
            - 'SELECT * FROM T ORDER BY id;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'DELETE FROM T WHERE id=1;;'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=12 WHERE id=1;;'
            - 'COMMIT;;'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'
    test17:    # Anomaly|Phantom update - Isolation|Serializable
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;;'
            - 'SELECT * FROM T ORDER BY id;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'INSERT INTO T VALUES (4,4);;'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=42 WHERE id=4;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'
    test18: # Anomaly|Read Skew - Isolation|Serializable
        step1_T1:
            - '----  TABLE INITIALIZATION  ----'
            - '\set AUTOCOMMIT on'
            - "DROP TABLE accounts;;"
            - 'CREATE TABLE accounts ( account_id INT NOT NULL PRIMARY KEY, balance INT);;'
            - "INSERT INTO accounts VALUES (1, 500);;"
            - "INSERT INTO accounts VALUES (2, 500);;"
            - '\set AUTOCOMMIT off'
            - '----   S T E P  1  ----'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;;'
            - 'SELECT * FROM accounts;;'
        step2_T2:
            - '----   S T E P  2  ----'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;;'
            - 'SELECT * FROM accounts;;'
        step3_T1:
            - '----   S T E P  3  ----'
            - 'UPDATE accounts SET balance = balance - 100 WHERE account_id = 1;;'
            - 'SELECT * FROM accounts;;'
        step4_T2:
            - '----   S T E P  4  ----'
            - 'SELECT balance from accounts WHERE account_id = 2;;'
        step5_T1:
            - '----   S T E P  5  ----'
            - 'UPDATE accounts SET balance = balance + 100 WHERE account_id = 2;;'
            - 'COMMIT;;'
            - 'SELECT * from accounts;;'
            - 'COMMIT;;'
        step6_T2:
            - '----   S T E P  6  ----'
            - 'SELECT balance from accounts WHERE account_id = 1;;'
            - 'COMMIT;;'
    test19:    # Anomaly|Write Skew - Isolation|Serializable
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'BEGIN TRANSACTION;;'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'           
            - 'SELECT id,x FROM T WHERE id=2;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=(SELECT X FROM T WHERE id=1) WHERE id=2;;'
            - 'SELECT id,x FROM T ORDER BY id;;'
        step4_T2:
            - '--   S T E P  4  --'
            - '-------------------'
            - 'UPDATE T SET x=(SELECT X FROM T WHERE id=2) WHERE id=1;;'          
            - 'SELECT id,x FROM T ORDER BY id;;'
        step5_T1:
            - '--   S T E P  5  --'
            - '-------------------'
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'
        step6_T2:
            - '--   S T E P  6  --'
            - '-------------------'
            - 'UPDATE T SET x=(SELECT X FROM T WHERE id=2) WHERE id=1;;'          
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'    
            - 'SELECT id,x FROM T ORDER BY id;;'
            - 'COMMIT;;'                          

sqlserver-tests:
    test1:    # Anomaly|Non-Repeatable Read - Isolation|Read Committed
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN TRANSACTION;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN TRANSACTION;;'
            - 'UPDATE T SET x=12 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'SELECT * FROM T ORDER BY id;;'
        step4_T2:
            - '--   S T E P  4  --'
            - '-------------------'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
        step5_T1:
            - '--   S T E P  5  --'
            - '-------------------'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'
    test2:    # Anomaly|Non-Repeatable Read - Isolation|Snapshot
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL SNAPSHOT;;'
            - 'BEGIN TRANSACTION;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN TRANSACTION;;'
            - 'UPDATE T SET x=12 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
            - 'SELECT * FROM T ORDER BY id;;'
    test3:    # Anomaly|Lost Update - Isolation|Read Committed
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN TRANSACTION;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN TRANSACTION;;'
            - 'UPDATE T SET x=12 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=13 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
            - 'SELECT * FROM T ORDER BY id;;'
    test4:    # Anomaly|Lost Update - Isolation|Snapshot
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL SNAPSHOT;;'
            - 'BEGIN TRANSACTION;;'
            - 'SELECT * FROM T WHERE id=1;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN TRANSACTION;;'
            - 'UPDATE T SET x=12 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=13 WHERE id=1;;'
            - 'SELECT * FROM T WHERE id=1;;'
            - 'COMMIT;;'
            - 'SELECT * FROM T ORDER BY id;;'
            
            
    test5:    # Anomaly|Ghost Update - Isolation|Snapshot
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL SNAPSHOT;;'
            - 'BEGIN TRANSACTION;;'
            - 'SELECT * FROM T ORDER BY id;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN TRANSACTION;;'
            - 'DELETE FROM T WHERE id=1;;'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=13 WHERE id=1;;'
            - 'COMMIT;;'
            - 'SELECT * FROM T ORDER BY id;;'
            
            
    test6:    # Anomaly|Phantom Update - Isolation|Snapshot
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL SNAPSHOT;;'
            - 'BEGIN TRANSACTION;;'
            - 'SELECT * FROM T ORDER BY id;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN TRANSACTION;;'
            - 'INSERT INTO T VALUES (4,4);;'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=42 WHERE id=4;;'
            - 'COMMIT;;'
    test7:    # Anomaly|Read Skew - Isolation|Read Committed
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN TRANSACTION;;'
            - 'SELECT * FROM T ORDER BY id;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN TRANSACTION;;'
            - 'UPDATE T SET x=12 WHERE id=1;;'
            - 'UPDATE T SET x=22 WHERE id=2;;'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'
            - 'SELECT * FROM T ORDER BY id;;'
         
         
    test8:    # Anomaly|Read Skew - Isolation|Snapshot
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL SNAPSHOT;;'
            - 'BEGIN TRANSACTION;;'
            - 'SELECT * FROM T ORDER BY id;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN TRANSACTION;;'
            - 'UPDATE T SET x=12 WHERE id=1;;'
            - 'UPDATE T SET x=22 WHERE id=2;;'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'
            - 'SELECT * FROM T ORDER BY id;;'
    test9:    # Anomaly|Write Skew - Isolation|Read Committed
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN TRANSACTION;;'
            - 'SELECT * FROM T ORDER BY id;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN TRANSACTION;;'
            - 'SELECT * FROM T WHERE id=2;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=(SELECT x FROM T WHERE id=1) WHERE id=2;;'
            - 'SELECT * FROM T ORDER BY id;;'
        step4_T2:
            - '--   S T E P  4  --'
            - '-------------------'
            - 'UPDATE T SET x=(SELECT x FROM T WHERE id=2) WHERE id=1;;'
            - 'SELECT * FROM T ORDER BY id;;'            
        step5_T1:
            - '--   S T E P  5  --'
            - '-------------------'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'         
        step6_T2:
            - '--   S T E P  6  --'
            - '-------------------'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'
            - 'SELECT * FROM T ORDER BY id;;'
            
            
    test10:   # Anomaly|Write Skew - Isolation|Snapshot
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL SNAPSHOT;;'
            - 'BEGIN TRANSACTION;;'
            - 'SELECT * FROM T ORDER BY id;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL SNAPSHOT;;'
            - 'BEGIN TRANSACTION;;'
            - 'SELECT * FROM T WHERE id=2;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=(SELECT x FROM T WHERE id=1) WHERE id=2;;'
            - 'SELECT * FROM T ORDER BY id;;'
        step4_T2:
            - '--   S T E P  4  --'
            - '-------------------'
            - 'UPDATE T SET x=(SELECT x FROM T WHERE id=2) WHERE id=1;;'
            - 'SELECT * FROM T ORDER BY id;;'            
        step5_T1:
            - '--   S T E P  5  --'
            - '-------------------'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'         
        step6_T2:
            - '--   S T E P  6  --'
            - '-------------------'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'
            - 'SELECT * FROM T ORDER BY id;;'
    test11:    # Anomaly|Ghost Update - Isolation|Read Committed
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN TRANSACTION;;'
            - 'SELECT * FROM T ORDER BY id;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN TRANSACTION;;'
            - 'DELETE FROM T WHERE id=1;;'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=13 WHERE id=1;;'
            - 'COMMIT;;'
            - 'SELECT * FROM T ORDER BY id;;'
    test12:    # Anomaly|Phantom Update - Isolation|Read Committed
        step1_T1:
            - '--   S T E P  1  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN TRANSACTION;;'
            - 'SELECT * FROM T ORDER BY id;;'
        step2_T2:
            - '--   S T E P  2  --'
            - '-------------------'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN TRANSACTION;;'
            - 'INSERT INTO T VALUES (4,4);;'
            - 'SELECT * FROM T ORDER BY id;;'
            - 'COMMIT;;'
        step3_T1:
            - '--   S T E P  3  --'
            - '-------------------'
            - 'UPDATE T SET x=42 WHERE id=4;;'
            - 'COMMIT;;'

    test13: # Anomaly|Write Skew - Isolation|Read Committed
        step1_T1:
            - '----  TABLE INITIALIZATION  ----'
            - "DROP TABLE doctors;;"
            - 'DROP FUNCTION IF EXISTS currently_on_call;;'
            - 'CREATE TABLE doctors ( name VARCHAR (10), on_call VARCHAR (10), shift_id INT);;'
            - "INSERT INTO doctors VALUES ('Alice', 'true', 1234);;"
            - "INSERT INTO doctors VALUES ('Bob', 'true', 1234);;"
            - "INSERT INTO doctors VALUES ('Carol', 'false', 1234);;"
            - 'CREATE FUNCTION currently_on_call() RETURNS int AS BEGIN RETURN (SELECT COUNT(*) FROM doctors where on_call = "true" and shift_id=1234); END;;'
            - '----   S T E P  1  ----'
            - 'ALTER DATABASE T SET READ_COMMITTED_SNAPSHOT ON;;'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN TRANSACTION;;'
            - 'SELECT * FROM doctors;;'
        step2_T2:
            - '----   S T E P  2  ----'
            - 'ALTER DATABASE T SET READ_COMMITTED_SNAPSHOT ON;;'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'SET LOCK_TIMEOUT 0;;'
            - 'BEGIN TRANSACTION;;'
            - 'SELECT * FROM doctors;;'
        step3_T1:
            - '--   S T E P  3  --'
            - 'SELECT dbo.currently_on_call();'
            - "IF dbo.currently_on_call() >= 2 UPDATE doctors SET on_call = 'false' WHERE name = 'Alice' and shift_id=1234;;"
            - 'GO' # used to make the terminal wait a little
            - 'COMMIT;;'
            - 'SELECT * FROM doctors;;'
        step4_T2:
            - '--   S T E P  4  --'
            - 'SELECT dbo.currently_on_call();'
            - "IF dbo.currently_on_call() >= 2 UPDATE doctors SET on_call = 'false' WHERE name = 'Bob' and shift_id=1234;;"
            - 'GO' # used to make the terminal wait a little
            - 'COMMIT;;'
            - 'SELECT * FROM doctors;;'

    test14: # Anomaly|Write Skew - Isolation|Snapshot
        step1_T1:
            - '----  TABLE INITIALIZATION  ----'
            - "DROP TABLE doctors;;"
            - 'DROP FUNCTION IF EXISTS currently_on_call;;'
            - 'CREATE TABLE doctors ( name VARCHAR (10), on_call VARCHAR (10), shift_id INT);;'
            - "INSERT INTO doctors VALUES ('Alice', 'true', 1234);;"
            - "INSERT INTO doctors VALUES ('Bob', 'true', 1234);;"
            - "INSERT INTO doctors VALUES ('Carol', 'false', 1234);;"
            - 'CREATE FUNCTION currently_on_call() RETURNS int AS BEGIN RETURN (SELECT COUNT(*) FROM doctors where on_call = "true" and shift_id=1234); END;;'
            - '----   S T E P  1  ----'
            - 'ALTER DATABASE T SET ALLOW_SNAPSHOT_ISOLATION ON;;'
            - 'SET TRANSACTION ISOLATION LEVEL SNAPSHOT;;'
            - 'BEGIN TRANSACTION;;'
            - 'SELECT * FROM doctors;;'
        step2_T2:
            - '----   S T E P  2  ----'
            - 'ALTER DATABASE T SET ALLOW_SNAPSHOT_ISOLATION ON;;'
            - 'SET TRANSACTION ISOLATION LEVEL SNAPSHOT;;'
            - 'SET LOCK_TIMEOUT 0;;'
            - 'BEGIN TRANSACTION;;'
            - 'SELECT * FROM doctors;;'
        step3_T1:
            - '--   S T E P  3  --'
            - 'SELECT dbo.currently_on_call();'
            - "IF dbo.currently_on_call() >= 2 UPDATE doctors SET on_call = 'false' WHERE name = 'Alice' and shift_id=1234;;"
            - 'GO' # used to make the terminal wait a little
            - 'COMMIT;;'
            - 'SELECT * FROM doctors;;'
        step4_T2:
            - '--   S T E P  4  --'
            - 'SELECT dbo.currently_on_call();'
            - "IF dbo.currently_on_call() >= 2 UPDATE doctors SET on_call = 'false' WHERE name = 'Bob' and shift_id=1234;;"
            - 'GO' # used to make the terminal wait a little
            - 'COMMIT;;'
            - 'SELECT * FROM doctors;;'

    test15: # Anomaly|Read Skew - Isolation|Read Committed
        step1_T1:
            - '----  TABLE INITIALIZATION  ----'
            - "DROP TABLE accounts;;"
            - 'CREATE TABLE accounts ( account_id INT NOT NULL PRIMARY KEY, balance INT);;'
            - "INSERT INTO accounts VALUES (1, 500);;"
            - "INSERT INTO accounts VALUES (2, 500);;"
            - 'ALTER DATABASE T SET READ_COMMITTED_SNAPSHOT ON;;'
            - '----   S T E P  1  ----'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN TRANSACTION;;'
            - 'SELECT * FROM accounts;;'
        step2_T2:
            - '----   S T E P  2  ----'
            - 'SET TRANSACTION ISOLATION LEVEL READ COMMITTED;;'
            - 'BEGIN TRANSACTION;;'
            - 'SELECT * FROM accounts;;'
        step3_T1:
            - '----   S T E P  3  ----'
            - 'UPDATE accounts SET balance = balance - 100 WHERE account_id = 1;;'
            - 'SELECT * FROM accounts;;'
        step4_T2:
            - '----   S T E P  4  ----'
            - 'SELECT balance from accounts WHERE account_id = 2;;'
        step5_T1:
            - '----   S T E P  5  ----'
            - 'UPDATE accounts SET balance = balance + 100 WHERE account_id = 2;;'
            - 'COMMIT;;'
            - 'SELECT * from accounts;;'
        step6_T2:
            - '----   S T E P  6  ----'
            - 'SELECT balance from accounts WHERE account_id = 1;;'

    test16: # Anomaly|Read Skew - Isolation|Snapshot
        step1_T1:
            - '----  TABLE INITIALIZATION  ----'
            - "DROP TABLE accounts;;"
            - 'CREATE TABLE accounts ( account_id INT NOT NULL PRIMARY KEY, balance INT);;'
            - "INSERT INTO accounts VALUES (1, 500);;"
            - "INSERT INTO accounts VALUES (2, 500);;"
            - 'ALTER DATABASE T SET ALLOW_SNAPSHOT_ISOLATION ON;;'
            - '----   S T E P  1  ----'
            - 'SET TRANSACTION ISOLATION LEVEL SNAPSHOT;;'
            - 'BEGIN TRANSACTION;;'
            - 'SELECT * FROM accounts;;'
        step2_T2:
            - '----   S T E P  2  ----'
            - 'SET TRANSACTION ISOLATION LEVEL SNAPSHOT;;'
            - 'BEGIN TRANSACTION;;'
            - 'SELECT * FROM accounts;;'
        step3_T1:
            - '----   S T E P  3  ----'
            - 'UPDATE accounts SET balance = balance - 100 WHERE account_id = 1;;'
            - 'SELECT * FROM accounts;;'
        step4_T2:
            - '----   S T E P  4  ----'
            - 'SELECT balance from accounts WHERE account_id = 2;;'
        step5_T1:
            - '----   S T E P  5  ----'
            - 'UPDATE accounts SET balance = balance + 100 WHERE account_id = 2;;'
            - 'COMMIT;;'
            - 'SELECT * from accounts;;'
        step6_T2:
            - '----   S T E P  6  ----'
            - 'SELECT balance from accounts WHERE account_id = 1;;'